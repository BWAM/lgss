---
title: "Untitled"
author: "Zachary M. Smith"
date: "December 21, 2018"
updated: "12/26/18 by Gavin Lemley""
output: html_document
---
`r format(Sys.Date(), "%m-%d-%Y")`

# Overview

This document was created to import the land cover data calculated by C. Stoll and G. Lemley for the LGSS project.

# Preparation

Import the necessary packages.
```{r}
library(tidyverse)
library(readxl)
```

Find the R-project root directory to simplify file path designations.
```{r}
root.dir <- rprojroot::find_root("lgss.Rproj")
```

Specify the file path to the XLS file.
```{r}
landcover.path <- file.path(root.dir,
                            "data",
                            "Batch_Land_Cover_Output_01312019.xls")
```

Identify all of the sheets in the XLS file.
```{r}
sheet.vec <- readxl::excel_sheets(landcover.path)
```

Import all of the sheets in the XLS file and bind them into a single data frame. The sheet name is used to generate the `site_id` column. The prefix "Basin_" is dropped from the `site_id` column.
```{r}
landcover.df <- purrr::map_df(sheet.vec, function(sheet.i) {
  readxl::read_xls(landcover.path,
                   sheet = sheet.i) %>% 
    mutate(site_id = sheet.i,
           site_id = str_replace(site_id, "Basin_", ""))
})
```

```{r}
landcover.df <- landcover.df %>% 
  group_by(site_id) %>% 
  mutate(total_acres = sum(Area_acre)) %>% 
  ungroup() %>% 
  mutate(percent_cover = Area_acre / total_acres * 100)
```

```{r}
NLCD_key <- read.csv(file.path(root.dir, "data", "NLCD_attribute_key_condensed_LGSS.csv"))
landcover.df <- merge(landcover.df,NLCD_key, by = "Value", all.x = TRUE)
```

```{r}
sitetype.df <- landcover.df %>% 
  filter(Condensed_class %in% c("Natural", "Wetland")) %>% 
  group_by(site_id) %>% 
  summarize(pct = sum(percent_cover)) %>% 
  mutate(site_type = ifelse(pct>=75,"ref","test"))

write.table(sitetype.df, file.path(root.dir, "data/compile_2016-17/LGSS_16-17_landuse.csv"),sep=",", row.names = FALSE)


```

